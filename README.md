# SignalR Integration With Azure Function Triggered By Service Bus .NET Core
SignalR configured in server-less mode to work with Azure Function triggered by Service Bus. All of it using .NET Core.

## Azure Functions development
A serverless real-time application built with Azure Functions and Azure SignalR Service typically requires two Azure Functions:

* A "negotiate" function that the client calls to obtain a valid SignalR Service access token and service endpoint URL
* One or more functions that send messages or manage group membership

# FunctionApp6
Deliberately named function app 6 because it was my sixth attempt trying to create a Azure Function with Service Bus trigger that'd work with SignalR. 

## Negotiate.cs
This function is triggered by a Http request. It is used by client applications to get a token from the SignalR service which clients can use to subscribe to a hub. This should always be named negotiate. For more information [read this guide](https://docs.microsoft.com/en-us/azure/azure-signalr/signalr-concept-serverless-development-config)

## Message.cs
This function is triggered by a Service Bus Trigger. It has a binding with SignalR service. It pulls the message from the queue and passes it on to a SignalR hub. 

### Instructions
1. Make sure you have a Service Bus Queue provisioned on Azure.
2. Make sure you have a SignalR service provisioned in serverless mode on Azure.
3. Enter your connection strings (Service Bus & SignalR) in the **local.settings.json file.**
4. Enter the URL of client application (SignalR client) in CORS. Honestly, this was a huge pain to figure out as most blogs have outdated syntax of enabling CORS. [This guide](https://docs.microsoft.com/en-us/azure/azure-signalr/signalr-concept-serverless-development-config) provided the updated syntax.
5. Enter your Service Bus Queue name in the Service Bus Trigger inside **Message.cs file**.

You are all set. Let's configure the client application to test. 

# SignalR Client
This a simple .NET Core web application to subscribe to the hub created by FunctionApp6 and display messages received on the Service Bus Queue in real time. Although you can use FunctionApp6 to work with a mobile client but for the purpose of this repository, I'll stick to the web client. 

### Instructions
1. Make sure FunctionApp6 is running first.
2. Copy the url generated by the Negotiate function. It will look something like this: http://localhost:7071/api/
3. Paste the url into chat.js inside signalR.HubConnectionBuilder().withUrl("YOUR_URL_HERE").build();
4. Run the application.
5. You'll see status connected when the web client successfully subscribes to the SignalR hub. 

# SendToQueue.js
This is a node js script to push a message to the Service Bus so that you can test the deployment you did above. 

### Instructions
1. Install the node Azure Service Bus module (@azure/service-bus). 
2. Enter your connection strings and queue name in the script.
3. Run the script. 

